# NuDesk 역할별 권한 및 워크플로우 (Role-Based Access Control)

이 문서는 NuDesk 시스템 내 각 사용자 역할(Role)에 따른 접근 권한, 기능 범위, 그리고 핵심 업무 워크플로우를 정의합니다.

## 1. 역할 정의 (Role Definitions)

*   **MASTER (시스템 최고 관리자)**: 시스템 전반의 운영을 총괄하며 모든 데이터를 제어합니다.
*   **ADMIN (운영 관리자)**: 실무 운영 권한을 가지며 인력, 고객사, 프로젝트 및 티켓 처리를 담당합니다.
*   **STAFF (실무 담당자)**: 실제 유지보수 및 개발 업무를 수행하며 할당된 프로젝트의 티켓을 처리합니다.
*   **CUSTOMER (고객사 유저)**: 서비스를 이용하는 외부 고객으로, 본인 고객사의 업무를 요청하고 확인합니다.

## 2. 메뉴 접근 권한 Matrix

| 메뉴명 | 경로 | MASTER | ADMIN | STAFF | CUSTOMER |
| :--- | :--- | :---: | :---: | :---: | :---: |
| **접수 리스트** | `/dashboard/tickets` | O | O | O | O |
| **인력 관리** | `/admin/users` | O | O | X | X |
| **고객사 관리** | `/admin/customers` | O | O | X | X |
| **프로젝트 관리** | `/dashboard/projects` | O | O | X | X |

---

## 3. 티켓 등록 워크플로우 (Ticket Registration)

역할에 따라 등록 폼의 노출 항목과 필수 입력 조건이 달라집니다.

### **MASTER**
*   **등록 권한**: 시스템 관리 전담으로, 티켓 등록 버튼이 노출되지 않습니다.

### **ADMIN / STAFF**
*   **상태**: 등록 즉시 **`ACCEPTED` (접수)** 상태로 저장됩니다. (인력과 종료일이 이미 지정되었으므로)
*   **입력 항목 (모두 필수)**:
    1.  **프로젝트**: 참여 중인 활성 프로젝트 목록 (1개여도 드롭다운 노출)
    2.  **접수 유형**: 온라인, 전화, 팩스, 이메일 중 선택
    3.  **제목 및 내용**
    4.  **내부 인력 배치**: 프로젝트 참여 인력 중 최소 1명 이상 선택
    5.  **종료 일자**: 룰에 따른 날짜 선택 (일반 3영업일 / 긴급 1영업일 이후)
    6.  **파일 첨부**: 선택 사항이나 입력 폼은 노출

### **CUSTOMER**
*   **상태**: 등록 시 **`WAITING` (대기)** 상태로 저장됩니다.
*   **입력 항목**:
    1.  **프로젝트**: 본인 고객사의 활성 프로젝트가 **1개면 자동 지정(숨김)**, **2개 이상이면 선택**.
    2.  **접수 유형**: **'온라인'으로 자동 고정(숨김)**.
    3.  **제목 및 내용**: 필수 입력.
    4.  **종료 일자**: 필수 선택 (운영진 확인 전 최초 희망일).
    5.  **내부 인력 배치**: **노출 안 됨**.
*   **제한**: 소속된 고객사가 비활성화 상태이거나 할당된 프로젝트가 없는 경우 등록 버튼이 숨겨집니다.

---

## 4. 티켓 상세 페이지 규칙 (`/dashboard/tickets/[id]`)

상세 페이지는 상태와 역할에 따라 레이아웃과 기능이 동적으로 변화하며, 최고의 사용자 경험을 위해 정돈된 정보 위계를 따릅니다.

### **정보 영역 (좌측 공통)**
*   **헤더 정보**: 고객사 명과 등록 일시를 상단에 회색조(`zinc-500/400`)로 노출하여 맥락을 제공합니다.
*   **본문 위계**:
    *   **제목**: `text-xl font-black` (20px) 크기로 업무의 핵심을 강조합니다.
    *   **내용**: `text-lg` (18px) 크기의 검정색 폰트로 가독성을 확보합니다.
*   **첨부 파일**: 파일이 있는 경우에만 목록을 노출하며, 별도의 타이틀 없이 목록만 깔끔하게 표시합니다.
*   **조치 계획**: 운영진의 첫 메시지를 본문과 동일한 위계로 표시합니다. 작성자/일시는 회색으로, 내용은 검정색(`text-lg`)으로 구성합니다.
*   **긴급 사유**: 긴급 건일 경우 조치 계획 하단에 독립된 붉은 톤의 섹션으로 강조하여 노출합니다.
*   **부가 정보 (2x2 그리드)**: 프로젝트, 요청자 성함, 최초 희망일, 최종 확정일을 하단에 컴팩트하게 배치합니다. 모든 라벨은 회색, 데이터는 검정색을 사용하며 이탤릭체는 사용하지 않습니다.

### **CUSTOMER 역할 레이아웃**
*   **`WAITING` (대기), `ACCEPTED` (접수)** 상태:
    *   우측 소통 영역을 숨기고 좌측 정보 영역을 **전체 너비(Full-width)**로 확장합니다.
*   **`IN_PROGRESS` (진행) 이상** 상태:
    *   우측 영역이 활성화되어 운영진과 댓글/파일로 소통할 수 있습니다.

### **ADMIN / STAFF 역할 레이아웃 및 자동화**
*   **`WAITING` 상태 진입 시**: 시스템이 자동으로 상태를 **`ACCEPTED` (접수)**로 변경합니다.
*   **`ACCEPTED` 상태 (우측 폼)**:
    *   **조치 계획 작성** 영역 노출 (타이틀 바는 제거).
    *   **종료일 확인 및 변경**: 
        *   **노출 조건**: 최초 희망 종료일(`initial_end_date`)이 **오늘보다 미래**인 경우에만 노출됩니다.
        *   **미노출 조건**: 최초 희망일이 **오늘이거나 이미 지난 경우**, 해당 섹션이 자동으로 숨겨지며 변경이 차단됩니다.
    *   **날짜 확정 로직**: 
        *   운영진이 달력에서 날짜를 선택하면 해당 날짜가 `confirmed_end_date`가 됩니다.
        *   달력이 숨겨졌거나 날짜를 선택하지 않고 메시지를 전송하면, **`initial_end_date`가 자동으로 `confirmed_end_date`로 저장**됩니다.
    *   **인력 배치**: 고객이 등록한 건이라 인력이 없다면 여기서 배치를 완료합니다.
    *   메시지 전송 시 상태가 즉시 **`IN_PROGRESS` (진행)**로 변경됩니다.
*   **`IN_PROGRESS`, `DELAYED`, `REQUESTED` 상태**:
    *   메신저 형태의 진행 히스토리 확인 및 댓글 작성이 가능합니다.
    *   상단 영역에 **[연기 요청]** 및 **[완료 요청]** 버튼이 활성화됩니다. (단, **연기 요청은 티켓당 1회**만 가능하며 요청 후에는 버튼이 영구적으로 숨겨집니다.)
*   **`COMPLETED` (완료) 상태**:
    *   모든 입력 폼이 비활성화되며 조회만 가능합니다.

---

## 5. 날짜 선택 룰 (Calendar Rules)

모든 종료일 선택 달력은 다음의 비즈니스 로직을 공통 적용합니다.
*   **기본**: 현재 날짜로부터 **주말 및 공휴일을 제외한 3영업일 이후**부터 선택 가능.
*   **긴급**: 현재 날짜로부터 **주말 및 공휴일을 제외한 1영업일 이후**부터 선택 가능.
*   **표시**: 선택 불가한 날짜는 `-`로 표시하거나 비활성화 처리.

---
*이 정의서는 시스템의 무결성을 유지하기 위한 기준이며, 모든 개발은 본 규칙을 준수해야 합니다.*
