# NuDesk 역할별 권한 및 워크플로우 (Role-Based Access Control)

이 문서는 NuDesk 시스템 내 각 사용자 역할(Role)에 따른 접근 권한, 기능 범위, 그리고 핵심 업무 워크플로우를 정의합니다.

## 1. 역할 정의 (Role Definitions)

*   **MASTER (시스템 최고 관리자)**: 시스템 전반의 운영을 총괄하며 모든 데이터를 제어합니다.
*   **ADMIN (운영 관리자)**: 실무 운영 권한을 가지며 인력, 고객사, 프로젝트 및 티켓 처리를 담당합니다.
*   **STAFF (실무 담당자)**: 실제 유지보수 및 개발 업무를 수행하며 할당된 프로젝트의 티켓을 처리합니다.
*   **CUSTOMER (고객사 유저)**: 서비스를 이용하는 외부 고객으로, 본인 고객사의 업무를 요청하고 확인합니다.

## 2. 메뉴 접근 권한 Matrix

| 메뉴명 | 경로 | MASTER | ADMIN | STAFF | CUSTOMER |
| :--- | :--- | :---: | :---: | :---: | :---: |
| **접수 리스트** | `/dashboard/tickets` | O | O | O | O |
| **인력 관리** | `/admin/users` | O | O | X | X |
| **고객사 관리** | `/admin/customers` | O | O | X | X |
| **프로젝트 관리** | `/dashboard/projects` | O | O | X | X |

---

## 3. 티켓 등록 워크플로우 (Ticket Registration)

역할에 따라 등록 폼의 노출 항목과 필수 입력 조건이 달라집니다.

### **MASTER**
*   **등록 권한**: 시스템 관리 전담으로, 티켓 등록 버튼이 노출되지 않습니다.

### **ADMIN / STAFF**
*   **상태**: 등록 즉시 **`ACCEPTED` (접수)** 상태로 저장됩니다. (인력과 종료일이 이미 지정되었으므로)
*   **입력 항목 (모두 필수)**:
    1.  **프로젝트**: 참여 중인 활성 프로젝트 목록 (1개여도 드롭다운 노출)
    2.  **접수 유형**: 온라인, 전화, 팩스, 이메일 중 선택
    3.  **제목 및 내용**
    4.  **내부 인력 배치**: 프로젝트 참여 인력 중 최소 1명 이상 선택
    5.  **종료 일자**: 룰에 따른 날짜 선택 (일반 3영업일 / 긴급 1영업일 이후)
    6.  **파일 첨부**: 선택 사항이나 입력 폼은 노출

### **CUSTOMER**
*   **상태**: 등록 시 **`WAITING` (대기)** 상태로 저장됩니다.
*   **입력 항목**:
    1.  **프로젝트**: 본인 고객사의 활성 프로젝트가 **1개면 자동 지정(숨김)**, **2개 이상이면 선택**.
    2.  **접수 유형**: **'온라인'으로 자동 고정(숨김)**.
    3.  **제목 및 내용**: 필수 입력.
    4.  **종료 일자**: 필수 선택 (운영진 확인 전 최초 희망일).
    5.  **내부 인력 배치**: **노출 안 됨**.
*   **제한**: 소속된 고객사가 비활성화 상태이거나 할당된 프로젝트가 없는 경우 등록 버튼이 숨겨집니다.

---

## 4. 티켓 상세 페이지 규칙 (`/dashboard/tickets/[id]`)

상세 페이지는 상태와 역할에 따라 레이아웃과 기능이 동적으로 변화합니다.

### **정보 영역 (좌측 공통)**
*   **상태, 프로젝트, 고객사, 작성자, 등록일, 제목, 내용, 첨부파일** 노출.
*   **종료일자**: 티켓 등록 시 저장된 최초 날짜(`initial_end_date`)를 고정 표시합니다.
*   **확정 종료일자**: 운영진이 최종 확정한 날짜(`confirmed_end_date`)를 표시합니다. 값이 입력되면 무조건 날짜를 보여줍니다.

### **CUSTOMER 역할 레이아웃**
*   **`WAITING` (대기), `ACCEPTED` (접수)** 상태:
    *   우측 소통 영역을 숨기고 좌측 정보 영역을 **전체 너비(Full-width)**로 확장합니다.
*   **`IN_PROGRESS` (진행) 이상** 상태:
    *   우측 영역이 활성화되어 운영진과 댓글/파일로 소통할 수 있습니다.

### **ADMIN / STAFF 역할 레이아웃 및 자동화**
*   **`WAITING` 상태 진입 시**: 시스템이 자동으로 상태를 **`ACCEPTED` (접수)**로 변경합니다.
*   **`ACCEPTED` 상태 (우측 폼)**:
    *   '업무 시작 메시지 작성' 영역 노출.
    *   **종료일 확인 및 변경**: 운영진이 최종 종료일을 확정합니다. (이때 선택한 값이 `confirmed_end_date`가 됨)
    *   **인력 배치**: 고객이 등록한 건이라 인력이 없다면 여기서 배치를 완료합니다.
    *   메시지 전송 시 상태가 즉시 **`IN_PROGRESS` (진행)**로 변경됩니다.
*   **`IN_PROGRESS`, `DELAYED`, `REQUESTED` 상태**:
    *   일반적인 진행 히스토리 확인 및 댓글 작성이 가능합니다.
*   **`COMPLETED` (완료) 상태**:
    *   모든 입력 폼이 비활성화되며 조회만 가능합니다.

---

## 5. 날짜 선택 룰 (Calendar Rules)

모든 종료일 선택 달력은 다음의 비즈니스 로직을 공통 적용합니다.
*   **기본**: 현재 날짜로부터 **주말 및 공휴일을 제외한 3영업일 이후**부터 선택 가능.
*   **긴급**: 현재 날짜로부터 **주말 및 공휴일을 제외한 1영업일 이후**부터 선택 가능.
*   **표시**: 선택 불가한 날짜는 `-`로 표시하거나 비활성화 처리.

---
*이 정의서는 시스템의 무결성을 유지하기 위한 기준이며, 모든 개발은 본 규칙을 준수해야 합니다.*
